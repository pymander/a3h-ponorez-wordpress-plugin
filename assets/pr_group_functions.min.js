var baseurl="https://www.hawaiifun.org/reservation/";if(getBaseUrl().match(/^https?:\/\/[a-z]+[:\/]/)||getBaseUrl().match(/reservation_test/)){baseurl=getBaseUrl()}function getBaseUrl(){var b=/^(.*[\/\\])external\/functions2\.js(?:\?|$)/;var a=document.getElementsByTagName("script");for(var c=0;c<a.length;c++){var d=a[c].src;if(d&&d.match(b)){return RegExp.$1}}return""}function checkAvailability(d,a,b,c){jQuery.ajax({type:"GET",url:baseurl+"externalservlet",dataType:"jsonp",success:d,error:function(e,g,f){alert(baseurl+" "+g+" "+f)},data:{action:"AVAILABILITYCHECKJSONP",activityid:jQuery.makeArray(a).join("|"),activitydate:b,minavailability:JSON.stringify(c)}})}function purchase(b){var a=$.Deferred();jQuery.ajax({type:"GET",url:baseurl+"externalservlet",dataType:"jsonp",data:{action:"PURCHASEJSONP",activityid:b.activityid,activitydate:b.activitydate,guestsandupgrades:JSON.stringify(b.guestsandupgrades),price:b.price,firstname:b.firstname,lastname:b.lastname,phone:b.phone,email:b.email,ccfirstname:b.ccfirstname,cclastname:b.cclastname,ccnumber:b.ccnumber,csc:b.csc,ccmonth:b.ccmonth,ccyear:b.ccyear,address:b.address,city:b.city,state:b.state,zip:b.zip,hotelid:b.hotelid,room:b.room,transportationrouteid:b.transportationrouteid,checklist:JSON.stringify(b.checklist)},statusCode:{200:function(d,e,c){if(d.errorMessage){a.reject(d.errorMessage)}else{a.resolve(d)}},500:function(c,e,d){a.reject(c.responseText)}}});return a.promise()}function showCalendar(c){var d={guests:{}};var b=false;var a=0;jQuery.each(c.guesttypeids,function(e,h){if(b){return}var g=h;var f=getGuestsCount(c,g,false);if(null!=f){a+=f;d.guests[g]=f}});if(0==a){alert("Please select guest count for all guest types")}else{calendar(c.activityids,c.datecontrolid,false,d,new Date().getDate()<25?1:2)}}function formatMoney(k){var h=2,g=".",e=",",f=k<0?"-":"",b=parseInt(k=Math.abs(+k||0).toFixed(h))+"",a=(a=b.length)>3?a%3:0;return f+(a?b.substr(0,a)+e:"")+b.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+e)+(h?g+Math.abs(k-b).toFixed(h).slice(2):"")}function showPriceAndAvailability(g){var b=getSelectedActivityId(g,false);var d=getActivityDate(g,false);var h={guests:{}};var a=getTransportationRouteId(g);var f=0;var e=false;var c=0;jQuery.each(g.guesttypeids,function(j,m){if(e){return}var l=m;var k=getGuestsCount(g,l,false);if(k==null){k=0}else{if(b!=null){var i=g.activityprices[b][l];f+=k*i;if(a==355){f+=k*15.71}}h.guests[l]=k;c+=k}});if(0==c){e=true}if(b!=null&&!e){jQuery("#"+g.pricecontrolid).html("$"+formatMoney(f))}else{jQuery("#"+g.pricecontrolid).html("")}if(d!=null&&!e){checkAvailability(function(i){jQuery.each(g.activityids,function(k,l){var j=l;if(!i[j]){jQuery("#"+g.activitycheckboxcontrolids[j]).attr("checked",false)}jQuery("#"+g.activitycheckboxcontrolids[j]).prop("disabled",!i[j]);jQuery("#"+g.activitydescriptioncontrolids[j]).css("color",i[j]?"black":"gray");jQuery("#"+g.activitynotavailablemessagecontrolids[j]).toggle(!i[j])})},g.activityids,d,h)}}function getSelectedActivityId(c,b){var a=null;jQuery.each(c.activityids,function(d,e){if(jQuery("#"+c.activitycheckboxcontrolids[e]).is(":checked")){a=e}});if(a==null&&b){alert("Please select seating package")}return a}function getGuestsCount(d,c,b){var a=jQuery("#"+d.guesttypecontrolids[c]).val();if(a==""){return 0}if(!/^\d+$/.test(a)){if(b){alert("Please select guest count")}return null}return parseInt(a)}function getActivityDate(c,b){var a=jQuery("#"+c.datecontrolid).val();if(!/^\d\d?\/\d\d?\/\d\d\d\d$/.test(a)){if(b){alert("Please select activity date")}return null}return a}function getTransportationRouteId(a){return jQuery("[name='"+a.transportationroutecontrolname+"']:visible:checked").val()}function getPromotionalCode(a){return jQuery("#"+a.promotionalcodecontrolid).val()}function getHotelId(a){return jQuery("#"+a.hotelcontrolid).val()}function getRoom(a){return jQuery("#"+a.roomcontrolid).val()}function selectActivity(a,b){if(!b.checked){return}jQuery.each(a.activityids,function(c,d){if(b.id==a.activitycheckboxcontrolids[d]){return}jQuery("#"+a.activitycheckboxcontrolids[d]).attr("checked",false)})}function booknow(d){var c=jQuery("."+d.cancellationpolicycontrolid+":not(:checked)");if(0<c.length){alert("Please check cancellation policy");return false}var a=getSelectedActivityId(d,true);if(a==null){return false}var b=getActivityDate(d,true);if(b==null){return false}reservation(d.supplierid,a,b,"",0);jQuery.each(d.guesttypeids,function(e,h){var g=h;var f=jQuery("#"+d.guesttypecontrolids[g]).val();addGuests(g,f)});setHotel(getHotelId(d));setRoom(getRoom(d));setTransportationRoute(getTransportationRouteId(d));setAccommodationFixed();setpromotionalcode(getPromotionalCode(d));availability_popup();return true};