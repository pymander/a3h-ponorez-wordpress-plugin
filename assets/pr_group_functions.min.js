var baseurl="https://www.hawaiifun.org/reservation/";if(getBaseUrl().match(/^https?:\/\/[a-z]+[:\/]/)||getBaseUrl().match(/reservation_test/)){baseurl=getBaseUrl()}function getBaseUrl(){var b=/^(.*[\/\\])external\/functions2\.js(?:\?|$)/;var a=document.getElementsByTagName("script");for(var c=0;c<a.length;c++){var d=a[c].src;if(d&&d.match(b)){return RegExp.$1}}return""}function checkAvailability(d,a,b,c){jQuery.ajax({type:"GET",url:baseurl+"externalservlet",dataType:"jsonp",success:d,error:function(e,g,f){alert(baseurl+" "+g+" "+f)},data:{action:"AVAILABILITYCHECKJSONP",activityid:jQuery.makeArray(a).join("|"),activitydate:b,minavailability:JSON.stringify(c)}})}function purchase(b){var a=$.Deferred();jQuery.ajax({type:"GET",url:baseurl+"externalservlet",dataType:"jsonp",data:{action:"PURCHASEJSONP",activityid:b.activityid,activitydate:b.activitydate,guestsandupgrades:JSON.stringify(b.guestsandupgrades),price:b.price,firstname:b.firstname,lastname:b.lastname,phone:b.phone,email:b.email,ccfirstname:b.ccfirstname,cclastname:b.cclastname,ccnumber:b.ccnumber,csc:b.csc,ccmonth:b.ccmonth,ccyear:b.ccyear,address:b.address,city:b.city,state:b.state,zip:b.zip,hotelid:b.hotelid,room:b.room,transportationrouteid:b.transportationrouteid,checklist:JSON.stringify(b.checklist)},statusCode:{200:function(d,e,c){if(d.errorMessage){a.reject(d.errorMessage)}else{a.resolve(d)}},500:function(c,e,d){a.reject(c.responseText)}}});return a.promise()}function showCalendar(b){var c={guests:{}};var a=false;jQuery.each(b.guesttypeids,function(d,g){if(a){return}var f=g;var e=getGuestsCount(b,f,true);if(e==null){a=true}else{c.guests[f]=e}});if(!a){calendar(b.activityids,b.datecontrolid,false,c,new Date().getDate()<25?1:2)}}function formatMoney(k){var h=2,g=".",e=",",f=k<0?"-":"",b=parseInt(k=Math.abs(+k||0).toFixed(h))+"",a=(a=b.length)>3?a%3:0;return f+(a?b.substr(0,a)+e:"")+b.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+e)+(h?g+Math.abs(k-b).toFixed(h).slice(2):"")}function showPriceAndAvailability(f){var b=getSelectedActivityId(f,false);var c=getActivityDate(f,false);var g={guests:{}};var a=getTransportationRouteId(f);var e=0;var d=false;jQuery.each(f.guesttypeids,function(i,l){if(d){return}var k=l;var j=getGuestsCount(f,k,false);if(j==null){d=true}else{if(b!=null){var h=f.activityprices[b][k];e+=j*h;if(a==355){e+=j*15.71}}g.guests[k]=j}});if(b!=null&&!d){jQuery("#"+f.pricecontrolid).html("$"+formatMoney(e))}else{jQuery("#"+f.pricecontrolid).html("")}if(c!=null&&!d){checkAvailability(function(h){jQuery.each(f.activityids,function(j,k){var i=k;if(!h[i]){jQuery("#"+f.activitycheckboxcontrolids[i]).attr("checked",false)}jQuery("#"+f.activitycheckboxcontrolids[i]).prop("disabled",!h[i]);jQuery("#"+f.activitydescriptioncontrolids[i]).css("color",h[i]?"black":"gray");jQuery("#"+f.activitynotavailablemessagecontrolids[i]).toggle(!h[i])})},f.activityids,c,g)}}function getSelectedActivityId(c,b){var a=null;jQuery.each(c.activityids,function(d,e){if(jQuery("#"+c.activitycheckboxcontrolids[e]).is(":checked")){a=e}});if(a==null&&b){alert("Please select seating package")}return a}function getGuestsCount(d,c,b){var a=jQuery("#"+d.guesttypecontrolids[c]).val();if(a==""){return 0}if(!/^\d+$/.test(a)){if(b){alert("Please select guest count")}return null}return parseInt(a)}function getActivityDate(c,b){var a=jQuery("#"+c.datecontrolid).val();if(!/^\d\d?\/\d\d?\/\d\d\d\d$/.test(a)){if(b){alert("Please select activity date")}return null}return a}function getTransportationRouteId(a){return jQuery("[name='"+a.transportationroutecontrolname+"']:visible:checked").val()}function getPromotionalCode(a){return jQuery("#"+a.promotionalcodecontrolid).val()}function getHotelId(a){return jQuery("#"+a.hotelcontrolid).val()}function getRoom(a){return jQuery("#"+a.roomcontrolid).val()}function selectActivity(a,b){if(!b.checked){return}jQuery.each(a.activityids,function(c,d){if(b.id==a.activitycheckboxcontrolids[d]){return}jQuery("#"+a.activitycheckboxcontrolids[d]).attr("checked",false)})}function booknow(d){var c=jQuery("."+d.cancellationpolicycontrolid+":not(:checked)");if(0<c.length){alert("Please check cancellation policy");return false}var a=getSelectedActivityId(d,true);if(a==null){return false}var b=getActivityDate(d,true);if(b==null){return false}reservation(d.supplierid,a,b,"",0);jQuery.each(d.guesttypeids,function(e,h){var g=h;var f=jQuery("#"+d.guesttypecontrolids[g]).val();addGuests(g,f)});setHotel(getHotelId(d));setRoom(getRoom(d));setTransportationRoute(getTransportationRouteId(d));setAccommodationFixed();setpromotionalcode(getPromotionalCode(d));availability_popup();return true};